<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>KInstagram</title>
    <!-- bootstrap css -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Google Icon -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <!-- Goolge Ponts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">

    {% load static %}
    <link rel="stylesheet" href="{% static 'css/main_style.css' %}?after">
    <!-- <link rel="stylesheet" href="css\styles.css"> -->

    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


</head>

<body>
    <!-- 상단바 -->
    <nav class="navbar navbar-expand-lg bg-body-tertiary" style="position:fixed; width:100%;">
        <div class="container-fluid" style=" justify-content: space-between;">
            <!-- 로고 -->
            <div>
                <a class="navbar-brand Logo" style="font-size:30px;" href="/main">KInstagram</a>
            </div>
            <!-- 검색칸 -->
            <div>
                <form class="d-flex" role="search">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                </form>
            </div>
            <!-- 아이콘 -->
            <div>
                <span class="material-symbols-outlined fill_icon"> home </span>
                <span class="material-symbols-outlined"> send </span>
                <span class="material-symbols-outlined"> explore </span>
                <span class="material-symbols-outlined"> favorite </span>
                <span id="nav_add_box" class="material-symbols-outlined"> add_box </span>
            </div>
        </div>
    </nav>
    <!-- 왼쪽 오른쪽 -->
    <div style="display: flex; justify-content: center; padding-top:65px;">

        <!-- 왼쪽(피드) -->
        <div class="left_part">
            {% if feeds %}
            {% for feed in feeds %}
            <div class="feed">
                <!-- 사용자정보 -->
                <div class="profile_section">
                    <div>
                        <img class="profile_image" src="{{feed.profile_image}}">
                    </div>
                    <div class="user_id">
                        {{feed.user_id}}
                    </div>
                </div>
                <!-- 사진 올리는 부분 -->
                <div class="photo_section">
                    <img src="{% get_media_prefix %}{{feed.image}}">
                </div>
                <!-- 아이콘 부분 -->
                <div class="icon_section">
                    <div>
                        <span class="material-symbols-outlined">favorite</span>
                        <span class="material-symbols-outlined">chat_bubble</span>
                        <span class="material-symbols-outlined"> send </span>
                    </div>
                    <div>
                        <span class="material-symbols-outlined"> bookmark </span>
                    </div>
                </div>
                <div style="font-size:14px;  margin-left:4px; margin-right:4px;">
                    <!-- 좋아요 수 -->
                    <div>
                        <b>좋아요 {{feed.like_count}}개</b>
                    </div>
                    <!-- 작성자, 작성자의 말 -->
                    <div style="display:flex;">
                        <div>
                            <b>{{feed.user_id}}</b>
                        </div>
                        <div style="margin-left:5px;">
                            {{feed.content}}
                        </div>
                    </div>
                    <!-- 댓글 -->
                    <div style="color:rgb(131, 131, 127)">
                        댓글 5258개 모두 보기
                    </div>
                    <!-- 댓글 입력창 -->
                    <div style="color:rgb(131, 131, 127); margin-left:-4px; margin-right:-4px;">
                        <input type="email" class="form-control" placeholder="댓글 달기..."
                            style="box-shadow:none; font-size:14px; border:none">
                    </div>
                </div>
                <hr style="margin-bottom: 0px;">
            </div>
            {%endfor%}
            {% else %}
            <div>비어있습니다.</div>
            {% endif %}

        </div>
        <!-- 오른쪽(추천) -->
        <div class="right_part">
            <!-- 내 정보 -->
            <div style="display:flex; justify-content: space-between;">
                <div class="profile_section">
                    <img class="profile_image"
                        src="https://img.khan.co.kr/news/2023/05/12/news-p.v1.20230512.e5fffd99806f4dcabd8426d52788f51a_P1.png">
                    <div>
                        <div id='my_id' class="user_id">ksm1236</div>
                        <div style="margin-left: 10px; color:rgb(117, 111, 111)">
                            aaaa
                        </div>
                    </div>
                </div>
                <div style="color:rgb(1, 102, 253); font-weight: bold; align-self: center;">
                    <a href="" class="link_style">전환</a>
                </div>
            </div>
            <hr>
            <!-- 회원 추천 -->
            <div>
                <div>
                    <div style="display:flex; justify-content: space-between;
                    color:rgb(117, 111, 111); font-weight: bold;
                    margin-top:-7px; margin-bottom:5px;">
                        회원님을 위한 추천
                        <a href="" class="link_style" style="color:black;">모두 보기</a>
                    </div>
                </div>
                <!-- 추천 리스트 -->
                <div style="display:flex; justify-content: space-between;">
                    <div class="profile_section">
                        <img class="profile_image"
                            src="https://i.namu.wiki/i/TYxKQDnuwFOcxdSaPR-L81SPQGf5aPEz13tINJ-Z508LKNtGmRmkZTKKEN82SrIZAYoLL8WSbXGzv2PiLgpRSg.webp">
                        <div>
                            <div class="user_id">
                                aaa123
                            </div>
                            <div style="margin-left: 10px; color:rgb(117, 111, 111)">
                                회원님을 위한 추천
                            </div>
                        </div>
                    </div>
                    <div style="color:rgb(1, 102, 253); font-weight: bold; align-self: center;">
                        <a href="" class="link_style">팔로우</a>
                    </div>
                </div>
                <div style="display:flex; justify-content: space-between;">
                    <div class="profile_section">
                        <img class="profile_image"
                            src="/media/default_profile.jpg">
                        <div>
                            <div class="user_id">
                                bbb456
                            </div>
                            <div style="margin-left: 10px; color:rgb(117, 111, 111)">
                                회원님을 위한 추천
                            </div>
                        </div>
                    </div>
                    <div style="color:rgb(1, 102, 253); font-weight: bold; align-self: center;">
                        <a href="" class="link_style">팔로우</a>
                    </div>
                </div>
            </div>
            <div style="color:rgb(117, 111, 111); padding-top:25px;">
                소개. 도움말. 홍보 센터. API. 채용 정보.
                개인정보처리방침. 약관. 위치. 언어. <br><br>
                © 2024 Instagram from Meta
            </div>
        </div>
    </div>

    <!-- 게시물 추가 기능 -->
    <div class="modal_overlay">
        <div class="modal_overlay_top">
            <button id="modal_X" class="modal_close">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        <div style="display: flex; align-items: center; justify-content: center;">
            <div class="modal_window">
                <div class="modal_window_top">
                    새 게시물 만들기
                </div>
                <hr>
                <div class="modal_window_bottom">
                    <div class="image_upload_section">
                        사진을 여기에 끌어다 놓으세요
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 게시물 추가 기능 스크립트 -->
    <script>
        // 게시물 추가 모달 창 띄우기
        $('#nav_add_box').click(function () {
            // modal 띄우기
            $('.modal_overlay').css({
                display: 'block',
                top: window.pageYOffset + 'px',
            })
            // 스크롤 없애기
            $(document.body).css({
                overflow: 'hidden',
            })
        })
        // modal 없애기
        $('#modal_X').click(function () {
            $('.modal_overlay').css({
                display: 'none',
            })
            $(document.body).css({
                overflow: 'scroll',
            })
            location.replace('/main')
        })
        // 드래그 앤 드롭 기능
        $('.image_upload_section')
            .on("dragover", dragOver)
            .on("dragleave", dragOver)
            .on("drop", uploadFiles);

        function dragOver(e) {
            e.stopPropagation();
            e.preventDefault();

            if (e.type == "dragover") {
                $(e.target).css({
                    "background-color": "skyblue",
                });
            } else {
                $(e.target).css({
                    "background-color": "white",
                });
            }
        }

        let files;
        // 사진을 업로드 했을 때
        function uploadFiles(e) {

            e.stopPropagation(); // 부모들에게 영향 주는 것을 막음
            e.preventDefault(); // 이벤트에 대한 기본 동작을 막음

            e.dataTransfer = e.originalEvent.dataTransfer;
            files = e.dataTransfer.files;

            if (files.length > 1) {
                alert('하나만 올려라.');
                return;
            }

            // 사진이 정상적으로 올라가면
            if (files[0].type.match(/image.*/)) {
                $('.modal_window_bottom').html(`
                    <div class='image_upload_section'></div>

                    <div style="width: 30%; height: 100%; margin-left: 10px; background-color: white">
                        <div style="outline: rgb(207, 197, 197) solid 1px">
                            <div class="mb-3">
                                <div class="profile_section" style="padding: 10px;">
                                    <img class="profile_image" src="https://img.khan.co.kr/news/2023/05/12/news-p.v1.20230512.e5fffd99806f4dcabd8426d52788f51a_P1.png">                                
                                    <label id='my_id' style="margin-left: 10px; font-weight: bold; font-size: 14px;">ksm1236</label>
                                </div>
                                <textarea class="form-control" id="feed_input_content" rows="7"
                                style="padding: 1px; resize: none; border: none; outline: none; box-shadow: none;
                                margin-bottom: -15px; padding-left: 15px;"></textarea>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: center; margin-top: 20px;">
                            <button id="feed_create_button" class="btn btn-primary">공유하기</button>
                        </div>
                    </div>
                `);
                $('.image_upload_section').css({
                    "width": '70%',
                    "background-image": "url(" + window.URL.createObjectURL(files[0]) + ")",
                    "outline": "solid 1px #cfc5c5",
                    "background-size": "contain",
                    "background-repeat": "no-repeat",
                    "background-color": "white",
                    "background-position": "center",
                });

                $('.modal_window').css({
                    "width": '900px',
                })

            } else {
                alert('이미지가 아닙니다.');
                $(e.target).css({
                    "background-color": "white",
                });
                return;
            }
        }
        // 글 작성 후 공유하기 버튼 클릭했을 때
        // 동적으로 생성된 버튼이기 때문에 $(document).on으로 접근
        $(document).on('click', '#feed_create_button', function () {
            let file = files[0];
            let img_name = file.name;
            let content = $('#feed_input_content').val();
            let user_id = $('#my_id').text();
            let profile_img = "https://img.khan.co.kr/news/2023/05/12/news-p.v1.20230512.e5fffd99806f4dcabd8426d52788f51a_P1.png";

            // alert('내용: ' + content + '\n아이디: ' + user_id);

            let fd = new FormData();            
            fd.append('file', file);
            fd.append('img_name', img_name)
            fd.append('content', content);
            fd.append('user_id', user_id);
            fd.append('profile_img', profile_img);

            /// /content/upload url로 접속하면 실행되는 함수로로 넘기기(view)
            $.ajax({
                url: "/content/upload",
                data: fd,
                method: "POST",

                processData: false,  // 데이터를 쿼리스트링으로 변환하지 않음
                contentType: false,

                success: function (data) {
                    console.log("성공");
                },
                error: function (request, status, error) {
                    console.log("에러");
                },
                complete: function () {
                    console.log("ajax 완료");
                    location.replace('/main')
                }
            }
            )
            console.log("클릭--");
        });



    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

</html>